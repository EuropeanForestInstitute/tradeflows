---
title: "Unit Prices"
author: "Paul Rougieux"
date: "04/12/2014"
output: html_document
---
```{r packages, echo=FALSE, warning=FALSE, message=FALSE}
library(knitr)
opts_knit$set(root.dir="../../..") # file paths are relative to the root of the project directory
opts_chunk$set(echo=FALSE)
library(tradeflows)
library(dplyr)
library(ggplot2)
library(reshape2)
``` 

* Calculate median price and standard deviation for sawnwood products by region.
* In a boxplot, the upper and lower "hinges" correspond to the first and third quartiles (the 25th and 75th percentiles).

Add a ditribution of trade volumes below these prices for a sample product.
As visible on this graph.


### Percentage of trade value not taken into account
As not all quantity are available, a part of the unit value cannot be taken into account for price calculation.
```{r}


```

### Unit prices by subregions
A simple unit price without ponderation for volumes.
```{r results='asis'}
print(load("data-raw/comtrade/440799.RData"))
swd99 <- dtf %>% 
    renamecolumns %>%
    filter(flow %in% c("Import", "Export")) %>%
    merge(select(reportercomtrade, reportercode, region, subregion)) %>%
    mutate(price = tradevalue / quantity)

for (f in c("Import", "Export")){
    #table of median flow prices
    swd99subregion <- swd99 %>% 
        filter(flow== f) %>%
        group_by(subregion) %>%
        summarise(medianprice = round(median(price, na.rm=TRUE))) %>%
        arrange(-medianprice)
    cat("\n\n")
    print(kable(swd99subregion))
    cat("\n\n")
    
    # Transform subregion to an ordered vector 
    swd99exp <- swd99 %>% filter(flow==f) %>%
        mutate(subregion = ordered(subregion, levels = swd99subregion$subregion)) 
    
    p <- ggplot(data=swd99exp, aes(x=subregion, y=price)) +
        geom_boxplot() + 
        theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
        ggtitle(paste(f, "440799"))
        
    print(p + scale_y_log10()) # Log scale
    print(p + coord_cartesian(ylim=c(0,1500))) # zoom plot 
    
}
```

```{r importprices}

```
